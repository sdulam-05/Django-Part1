{% extends 'main.html' %}

{% block content %}
<h1>Home</h1>

<style>
    .home-container {
        display: grid;
        grid-template-columns: 1fr 3fr 1fr;
        gap: 20px;
    }
    .topics-container, .activity-container {
        background: #f8f8f8;
        padding: 10px;
        border-radius: 5px;
    }
    .room-container {
        padding: 10px;
        background: #fff;
        border-radius: 5px;
    }
    .room-box {
        padding: 10px;
        border: 1px solid #ddd;
        margin-bottom: 10px;
        border-radius: 5px;
    }
    .room-box a {
        font-weight: bold;
        color: #007bff;
        text-decoration: none;
    }
    .room-box small {
        color: #666;
    }
    .btn {
        padding: 5px 10px;
        background: #007bff;
        color: white;
        border-radius: 5px;
        text-decoration: none;
        display: inline-block;
        margin-right: 5px;
    }
    .btn-delete {
        background: red;
    }
    .search-form {
        margin-bottom: 20px;
    }
    .search-input {
        padding: 5px;
        width: 250px;
    }
</style>

<!-- SEARCH FORM -->
<form method="GET" class="search-form">
    <input type="text" name="q" class="search-input" placeholder="Search rooms..." value="{{ request.GET.q }}">
    <button type="submit" class="btn">Search</button>
</form>

<div class="home-container">

    <!-- BROWSE TOPICS -->
    <div class="topics-container">
        <h3>Browse Topics</h3>
        <hr>
        <div>
            <a href="{% url 'home' %}" class="btn">ALL</a>
        </div>
        {% for topic in topics %}
        <div>
            <a href="{% url 'home' %}?q={{ topic.name }}">{{ topic.name }}</a>
        </div>
        {% endfor %}
    </div>

    <!-- ROOMS LIST -->
    <div class="room-container">
        <h5>{{ room_count }} rooms available</h5>

        {% if request.user.is_authenticated %}
            <a href="{% url 'create-room' %}" class="btn">Create Room</a>
        {% endif %}

        {% for room in rooms %}
        <div class="room-box">
            <h5><a href="{% url 'room' room.id %}">{{ room.name }}</a></h5>
            <small>Topic: {{ room.topic.name }}</small>
            <br>
            <small>Host: @{{ room.host.username }}</small>

            {% if request.user == room.host %}
                <a href="{% url 'update-room' room.id %}" class="btn">Edit</a>
                <a href="{% url 'delete-room' room.id %}" class="btn btn-delete">Delete</a>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- RECENT ACTIVITY -->
    <div class="activity-container">
        <h3>Recent Activity</h3>
        <hr>
        {% for message in room_messages %}
        <div>
            <small><strong>@{{ message.user.username }}</strong> replied to 
                <a href="{% url 'room' message.room.id %}">{{ message.room.name }}</a> 
                - {{ message.created|timesince }} ago
            </small>
            <p>{{ message.body|truncatechars:50 }}</p>
            <hr>
        </div>
        {% endfor %}
    </div>
    <div class="home-container">
        {% include 'base/topics_component.html' %}
        {% include 'base/feed_component.html' %}
        {% include 'base/activity_component.html' %}
    </div>
    

</div>

{% endblock content %}
